asyncapi: '3.0.0'
info:
  title: Mindwm API
  version: '0.1.0'
  description: This document describes the documentation, a collection of JSON schemas and example cloudevent and payloads
  license:
    name: Apache 2.0
    url: https://www.apache.org/licenses/LICENSE-2.0
servers:
  asciinema:
    host: /tmp/mindwm-asciinema-${MINDWM_UUID}.socket
    protocol: unixsocket
    description: Asciinema
    variables:
      USER_HOST:
        default: localhost
    externalDocs:
      url: https://github.com/mindwm/mindwm-manager/blob/dc926f637bb8d31f21ecbd28479ab9b0a1ece23c/src/mindwm/modules/tmux_session.py
  mindwm-client:
    host: /tmp/mindwm-asciinema-${MINDWM_UUID}.socket
    protocol: unixsocket
    description: "Mindwm Client      \n"
    variables:
      USER_HOSTNAME:
        default: localhost
    externalDocs:
      url: https://github.com/mindwm/mindwm-manager/blob/dc926f637bb8d31f21ecbd28479ab9b0a1ece23c/src/mindwm/modules/pipe_listener.py
  nats:
    host: ${address}:${port}
    protocol: nats
    description: |
      Nats Server
    variables:
      address:
        enum:
        - '10.20.30.211'
        - nats.nats
        default: nats.nats
      port:
        enum:
        - '31101'
        - '4222'
        default: '4222'
channels:
  HostNatsTopicIoDocument:
    address: mindwm.${USER}.${HOSTNAME}.tmux.${TMUX_SOCKET}.${MINDWM_UUID}.${TMUX_ID}.${TMUX_PANE_ID}.iodocument
    servers:
    - $ref: '#/servers/nats'
    messages:
      IoDocument:
        $ref: '#/components/messages/CloudEvent'
  HostNatsTopicClipboard:
    address: mindwm.${USER}.${HOSTNAME}.clipboard
    servers:
    - $ref: '#/servers/nats'
    messages:
      Clipboard:
        $ref: '#/components/messages/CloudEvent'
operations:
  IoDocument:
    action: send
    channel:
      $ref: '#/channels/HostNatsTopicIoDocument'
    messages:
    - $ref: '#/channels/HostNatsTopicIoDocument/messages/IoDocument'
  Clipboard:
    action: send
    channel:
      $ref: '#/channels/HostNatsTopicClipboard'
    messages:
    - $ref: '#/channels/HostNatsTopicClipboard/messages/Clipboard'
components:
  messages:
    CloudEvent:
      summary: Basic IoDocument produced by mindwm-client
      payload:
        $ref: '#/components/schemas/CloudEvent'
  schemas:
    CloudEvent:
      $ref: https://raw.githubusercontent.com/cloudevents/spec/main/cloudevents/formats/cloudevents.json
      discrimniator: type

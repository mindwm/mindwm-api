name: Two Step Workflow

on:
  push:
    branches:
      - master

jobs:
  generate-and-grep:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: KCL run
      uses: addnab/docker-run-action@v3
      with:
        image: kcllang/kcl:v0.9.0
        options: -v ${{ github.workspace }}:/github/workspace
        run: | 
          pwd
          ls
          cd /github/workspace/
          kcl run ./mindwm_asyncapi | tee asyncapi.yaml
          kcl run ./mindwm_openapi | tee openapi.yaml

    - name: Generate
      uses: addnab/docker-run-action@v3
      with:
        image: alpine:latest
        options: -v ${{ github.workspace }}:/github/workspace
        run: | 
          pwd
          ls
          cd /github/workspace/
          ls
          test -n asyncapi.yaml && cat asyncapi.yaml

